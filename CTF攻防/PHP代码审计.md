## PHP代码审计

### 0x01. 基础与原理

代码审计大致分为三类，分别为：

1. 通读全文法
2. 函数回溯法(工具审计)
3. 定向功能分析法

常见的功能漏洞：

- 程序初始安装漏洞
- 站点信息泄露
- 文件上传管理
- 登录认证、权限管理漏洞
- 数据库备份漏洞
- 验证码漏洞等



- 短标签 `short_open_tag`

在php.ini文件中找到并将`short_open_tag`设置为on ，然后重启phpstudy服务

这个设置决定是否允许使用 PHP 代码开始标志的缩写形式（&lt;? ?&gt;）。

如果禁用了，必须使用 PHP 代码开始标志的完整形式（&lt;?php ?&gt;）。

本指令也会影响到缩写形式 &lt;?=，它和 &lt;? echo 等价。使用此缩写需要 short_open_tag 的值为 On。

在`short_open_tag = on`的状态下，我们使用`<?=$test?>`语句，就可以输出$test的内容，如果为off，则不能正常输出，所以还是建议开启



- 禁用类/函数：`disable_functions`

这个函数可以禁用一些函数，比如system（）,现在我们再次使用system函数调用cmd命令`whoami`



- 错误信息控制

  `display_error` = On

允许输出报错信息，在线上必须要关闭此功能，以免暴露信息，在调试的时候我们当然要打开这个选项，否则什么错误信息也看不到了

- 错误报告级别

  `error_reporting` = E_ALL

- 是否允许包含远程文件

  `allow_url_include` = off

想必学习过渗透知识的朋友都知道这个选项，这个选项非常危险，它可以包含远程的文件，任意格式都执行为php，因此必须关闭



- 魔术引号

  `magic_quotes_gpc` = On

当打开时，所有的 '（单引号），"（双引号），\（反斜线）和 NULL 字符都会被自动加上一个反斜线进行转义。这和 addslashes() 作用完全相同。

`magic_quotes_runtime`

如果打开的话，大部份从外部来源取得数据并返回的函数，包括从数据库和文本文件，所返回的数据都会被反斜线转义。

打开它有一个严重的效率问题，使得运行速度变慢，因此本特性已自 PHP 5.3.0 起废弃并将自 PHP 5.4.0 起移除

- 是否允许打开远程文件

  `allow_url_fopen` = on

本选项激活了URL形式的fopen封装协议使得可以访问URL对象,例如文件 选择on后，将激活此选项，可以远程打开