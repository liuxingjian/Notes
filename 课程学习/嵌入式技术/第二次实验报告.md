### 实验名称

串口通信及中断实验

### 实验目的

（1）熟悉MCU的异步串行通信UART的工作原理，掌握UART的通信编程方法，以UART接收中断为例，掌握中断的基本编程方法。

（2）掌握串口组帧编程方法。

（3）掌握PC机的C#串口通信编程方法。

### 实验内容

#### 验证性实验





#### 设计性实验



```c
void UART_User_Handler(void)
{
	DISABLE_INTERRUPTS; //关总中断
	//------------------------------------------------------------------

	// 要接收的数据最后两个字符一定要以'\', '0'结尾
	//	uart_reN()在接收完毕后会自动去掉这两个字符
	uint32_t len = uart_reN(UART_User, gRecvBuff);
	if (len) {
		uart_send_string(UART_User, gRecvBuff);

		if (!strcmp(gRecvBuff, "open")) {
			gpio_set(LIGHT_BLUE, LIGHT_ON);
		}
		if (!strcmp(gRecvBuff, "close")) {
			gpio_set(LIGHT_BLUE, LIGHT_OFF);
		}
	}

	//------------------------------------------------------------------
	ENABLE_INTERRUPTS; //开总中断
}
```



#### 进阶实验





### 实验过程



### 实验问答

（1）波特率9600bps和115200bps的区别是什么？

主要区别是单位时间内发送字节数的多少。9600bps每秒发送1200字节数数据。115200每秒发送14400字节数据。

（2）有什么最简单的方法知道GEC串口的TX发送了信号？

使用示波器或者逻辑分析仪

（3）串口通信中用电平转换芯片（RS-485或RS-232）进行电平转换，程序是否需要修改？说明原因。

不需要，根据分层原则可知，物理层的电平转换方式的改变对上一层是透明的。

（4）不用其他工具，如何测试发送一个字符的真实时间？

使用定时器和空闲线中断。

（5）GEC方的串口接收中断编程，在PC机方C#编程中是如何描述的？

C#事件触发机制。当有数据发送给上位机时，触发串口接收事件，调用处理函数处理数据。



### 实验小结

通过本次实验，我学习了UART串口通信的基本原理，熟悉了串口通信的基本过程。初步掌握了使用C#编写上位机的基本技能。